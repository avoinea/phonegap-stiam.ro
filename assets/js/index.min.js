var SERVER="http://stiam.ro";$.fn.rodate=function(b){var c={};var a=function(g){var f=$("#current-time");if(f.length){f=new Date(f.text())}else{f=new Date()}var l=new Date(g.text());var m=(f-l)/1000;if(m<0){g.text("acum cateva secunde");return}if(m<120){g.text("acum un minut");return}if(m<3300){var h=parseInt(m/60,10);g.text("acum "+h+" minute");return}if(m<7200){g.text("acum o ora");return}if(m<72000){var k=parseInt(m/3600,10);g.text("acum "+k+" ore");return}m=m/3600;if(m<48){g.text("ieri");return}if(m<160){var n=parseInt(m/24,10);g.text("acum "+n+" zile");return}if(m<336){g.text("saptamana trecuta");return}if(m<720){var d=parseInt(m/24/7,10);g.text("acum "+d+" saptamani");return}m=m/24;if(m<60){g.text("acum o luna");return}if(m<360){var e=parseInt(m/30,10);g.text("acum "+e+" luni");return}if(m<720){g.text("acum un an");return}if(m>720){var j=parseInt(m/360,10);g.text("acum "+j+" ani")}};return this.each(function(){if(b){$.extend(c,b)}var d=$(this);a(d)})};if(!window.Stiam){var Stiam={version:"1.0"}}Stiam.Events={query:"stiam-query",app:"stiam-app",reset:"stiam-reset",refresh:"stiam-refresh"};Stiam.Analytics={initialize:function(){if(!window.isphone){return}window.plugins.analytics.start("UA-10574661-4",function(){if(window.console){console.log("Analytics started")}},function(){if(window.console){console.log("Analytics failled")}})},trackPage:function(b,a){if(!window.isphone){return}b="/mobile-app"+b;if(a){a=jQuery.param(a,traditional=true);a=a.replace("http://stiam.ro/","").replace("http%3A%2F%2Fstiam.ro%2F","");b+="?"+a}window.plugins.analytics.trackPageView(b,function(){if(window.console){console.log("track: "+b)}},function(){if(window.console){console.log("track fail: "+b)}})}};Stiam.Panel=function(c,b){var a=this;a.context=c;a.settings={button:"",server:SERVER+"/revista-presei-romanesti/app.json?callback=?",categories:{},sources:{}};if(b){$.extend(a.settings,b)}return a.initialize()};Stiam.Panel.prototype={initialize:function(){var a=this;a.changed=true;a.context.on("panelclose",function(b,c){return a.query()});$(document).unbind(".StiamPanel");$(document).bind(Stiam.Events.reset+".StiamPanel",function(b,c){a.reset(c)});a.update()},query:function(){var b=this;if(!b.changed){return}var d=$("form",b.context);var a=$(":checked",d);var c=a.length;b.settings.button.find(".ui-btn-text").text(c);var e={};$.each(a,function(f,h){var g=$(h).data("key");value=$(h).data("value");if(!e[g]){e[g]=[]}e[g].push(value)});Stiam.Storage.setQuery(e);$(document).trigger(Stiam.Events.query);b.changed=false},update:function(){var a=this;$.mobile.showPageLoadingMsg();$.ajax({url:a.settings.server,dataType:"jsonp",crossDomain:true,error:function(b,d,c){a.error("Eroare. Va rugam verificati conexiunea la internet")},success:function(c,d,b){$.extend(a.settings,c);a.updateSection(a.settings.sources);a.updateSection(a.settings.categories);a.reload()},complete:function(){$.mobile.hidePageLoadingMsg()}})},updateSection:function(c){var a=this;var d=c.properties.name;if(!c.dataset){c.dataset=[]}var b=Stiam.Storage.getQuery();$.each(c.items,function(e,f){c.dataset.push({name:d+"--"+f,title:f,on:($.inArray(f,b[d]||[])!==-1)})})},reload:function(){var a=this;a.reloadSection(a.settings.sources,"sources");a.reloadSection(a.settings.categories,"categories");a.query()},reloadSection:function(g,b){var c=this;var d;var f=g.dataset;var h=g.properties.name;var a=c.context.find("#"+b);var e=a.find("legend");a.empty();e.appendTo(a);$.each(f,function(j,l){var k=l.on?"checked":null;d='<input type="checkbox" ';if(l.on){c.changed=true;d+='checked="checked" '}d+='name="'+l.name+'" id="'+l.name+'" data-value="'+l.title+'" data-key="'+h+'">';d+='<label for="'+l.name+'">'+l.title+"</label>";d=$(d);d.appendTo(a)});c.context.find('input[type="checkbox"]').checkboxradio();c.context.find("form :input").on("change",function(){c.changed=true})},reset:function(c){var b=this;var a=$("form :checked",b.context);a.attr("checked",false);a.checkboxradio("refresh");b.changed=true;b.context.trigger("panelclose")},error:function(a){$.mobile.showPageLoadingMsg("e",a)}};Stiam.Settings=function(c,b){var a=this;a.context=c;a.settings={button:""};if(b){$.extend(a.settings,b)}return a.initialize()};Stiam.Settings.prototype={initialize:function(){var a=this;a.changed=[];$('[name="theme"]',a.context).change(function(){var b=$(this).val();Stiam.Storage.setItem("theme",b);a.theme(["theme"])});a.context.on("panelclose",function(b,d){var c=$("form",a.context).serializeArray();$.each(c,function(e,g){var f=g.name;var h=g.value;if(Stiam.Storage.getItem(f)!==h){Stiam.Storage.setItem(f,h);a.changed.push(f)}});if(a.changed.length){$(document).trigger(Stiam.Events.refresh,{changed:a.changed});a.changed=[]}});$(document).unbind(".StiamSettings");$(document).bind(Stiam.Events.refresh+".StiamSettings",function(b,c){var d=c?c.changed:[];a.theme(d)});a.update();a.theme(["theme"])},update:function(){var b=this;var c=Stiam.Storage.getItem("theme")||"b";var a=$('[name="theme"]',b.context);a.val(c);a.selectmenu("refresh");c=Stiam.Storage.getItem("showImages")||"on";a=$('[name="showImages"]',b.context);a.val(c);a.slider("refresh");c=Stiam.Storage.getItem("infiniteScroll")||"on";a=$('[name="infiniteScroll"]',b.context);a.val(c);a.slider("refresh");c=Stiam.Storage.getItem("fontSize")||100;a=$('[name="fontSize"]',b.context);a.val(parseInt(c,10));a.slider("refresh")},theme:function(c){var a=this;if($.inArray("theme",c)===-1){return}var b=Stiam.Storage.getItem("theme")||"b";$(document).find(".ui-btn").removeClass("ui-btn-up-a ui-btn-up-b ui-btn-up-c ui-btn-up-d ui-btn-up-e ui-btn-hover-a ui-btn-hover-b ui-btn-hover-c ui-btn-hover-d ui-btn-hover-e").addClass("ui-btn-up-"+b).attr("data-theme",b);$(document).find(".ui-header, .ui-footer").removeClass("ui-bar-a ui-bar-b ui-bar-c ui-bar-d ui-bar-e").addClass("ui-bar-"+b).attr("data-theme",b);$(document).find(".ui-panel").removeClass("ui-body-a ui-body-b ui-body-c ui-body-d ui-body-e").addClass("ui-body-"+b).attr("data-theme",b)}};Stiam.Listing=function(c,b){var a=this;a.context=c;a.settings={server:SERVER+"/revista-presei-romanesti/query.json?callback=?",dataset:[],properties:{}};if(b){$.extend(a.settings,b)}return a.initialize()};Stiam.Listing.prototype={initialize:function(){var a=this;a.container=$(".container",a.context);a.container.masonry({itemSelector:".article-brick"});$(document).unbind(".StiamListing");$(document).bind(Stiam.Events.query+".StiamListing",function(b,e){var c=true;var d=Stiam.Storage.getQuery();if(d.b_start&&d.b_start!==0){c=false}a.update(c)});$(document).bind(Stiam.Events.refresh+".StiamListing",function(b,c){var d=c?c.changed:[];a.refresh(d)})},more:function(){var a=this;var b=$(['<div class="article-brick">','<div class="article more-articles">','<div class="article-body">','<div class="article-inner">',"<button>Mai multe ştiri</button>","</div>","</div>","</div>","</div>"].join("\n"));b.appendTo(a.container);$("button",b).button();$("button",b).click(function(){$(this).unbind("click");var c=Stiam.Storage.getQuery();if(!c.b_start){c.b_start=20}else{c.b_start+=20}Stiam.Storage.setQuery(c);$(document).trigger(Stiam.Events.query);a.container.masonry("remove",b)});a.container.masonry("appended",b,true)},refresh:function(b){var a=this;if(($.inArray("showImages",b)!==-1)||($.inArray("fontSize",b)!==-1)){$(document).trigger(Stiam.Events.query)}},update:function(b){var a=this;$.mobile.showPageLoadingMsg();$.ajax({url:a.settings.server,dataType:"jsonp",crossDomain:true,traditional:true,data:Stiam.Storage.getQuery(),error:function(c,e,d){a.error("Eroare. Va rugam verificati conexiunea la internet");alert("Eroare. Va rugam verificati conexiunea la internet")},success:function(d,e,c){a.settings.dataset=d.items;a.settings.properties=d.properties;a.reload(b)},complete:function(){$.mobile.hidePageLoadingMsg()}})},reload:function(c){var a=this;Stiam.Analytics.trackPage("/",Stiam.Storage.getQuery());if(c){a.container.empty()}$.each(a.settings.dataset,function(d,f){var e='<div class="article-brick"><a href="#article-page" class="article" data-transition="none">';if(f.thumbnail&&Stiam.Storage.getItem("showImages")==="on"){e+='<div class="article-thumb-container">';e+='<img class="article-thumb" src="'+f.thumbnail+'" />';e+="</div>"}e+='<div class="article-body"><div class="article-inner">';e+='<h3 class="documentFirstHeading" style="font-size:'+(parseInt(Stiam.Storage.getItem("fontSize"),10)+72)+'%">'+f.title+"</h3>";e+='<div class="documentByLine">';e+="<span>"+f.source+" - </span>";e+='<span class="rodate">'+f.date+"</span>";e+="</div>";e+='<p class="documentDescription" style="font-size: '+Stiam.Storage.getItem("fontSize")+'%;">'+f.description+"</p>";e+="</div></div>";e+="</a></div>";e=$(e);e.appendTo(a.container);e.click(function(){a.click($(this),f)});if(!c){a.container.masonry("appended",e,true)}});$(".rodate",a.context).rodate();if(c&&!a.settings.dataset.length){var b=$(['<div class="article-brick">','<div class="article">','<div class="article-body"><div class="article-inner">','<h3 class="documentFirstHeading"  style="font-size:'+(parseInt(Stiam.Storage.getItem("fontSize"),10)+72)+'%">Nu exista articole care sa corespunda filtrelor selectate</h3>',"<button>Sterge toate filtrele</button>","</div>","</div>"].join("\n"));b.appendTo(a.container);$("button",b).button();$("button",b).click(function(d){$(document).trigger(Stiam.Events.reset)});a.container.masonry("appended",b,true)}else{a.more()}if(c){a.container.masonry("reload")}},error:function(a){$.mobile.showPageLoadingMsg("e",a)},click:function(e,c){var b=this;Stiam.Analytics.trackPage("/article-details/",{url:c.url});var a=$("#article-page").find("#article-details");a.empty();var d="<div class='article'>";d+='<div class="article-body"><div class="article-inner">';d+='<h3 class="documentFirstHeading" style="font-size:'+(parseInt(Stiam.Storage.getItem("fontSize"),10)+72)+'%">'+c.title+"</h3>";d+='<div class="documentByLine">';d+='<a href="'+c.original+'">'+c.source+"</a>";d+='<span> - </span><span class="rodate">'+c.date+"</span>";d+="</div>";if(c.thumbnail&&Stiam.Storage.getItem("showImages")==="on"){d+='<img class="article-thumb" src="'+c.thumbnail+'" />'}d+='<p class="documentDescription" style="font-size: '+Stiam.Storage.getItem("fontSize")+'%">'+c.description+"</p>";d+="</div></div>";d+='<div class="details">';d+='<img class="loading" src="css/images/ajax-loader-2.gif"/>';d+="</div></div>";d=$(d);d.find("a").click(function(g){return b.external(g,$(this))});d.appendTo(a);$(".rodate",a).rodate();b.details(a,c);b.theme(["theme"]);var f=$("#article-page").find('[data-icon="star"]');if(!window.isphone){f.attr("target","_blank");f.attr("href",c.url)}else{f.unbind("click");f.click(function(g){g.preventDefault();window.plugins.share.show({subject:c.title,text:c.url},function(){},function(){alert("Share failed")})})}},details:function(e,d){var a=this;var c=d.url.lastIndexOf("/");var b=d.url.substr(0,c)+"/diffbot.json?callback=?";$.mobile.showPageLoadingMsg();$.ajax({url:b,data:{url:d.original},dataType:"jsonp",crossDomain:true,error:function(f,h,g){a.error("Eroare. Va rugam verificati conexiunea la internet")},success:function(j,m,h){if(j.error){a.error(j.error)}if(!j.text){return}var k=j.text;k=k.replace(/\n/g,"</p><p>");var l=$('<div class="documentDetails" style="font-size: '+Stiam.Storage.getItem("fontSize")+'%">');var f=$(['<div class="documentViewOriginal">','<a href="'+d.original+'">Vezi articolul original</a>',"</div>"].join(""));$(k).appendTo(l);var g=e.find(".details");g.html(l);f.appendTo(g);g.find("a").click(function(n){return a.external(n,$(this))})},complete:function(){$.mobile.hidePageLoadingMsg();a.theme(["theme"])}})},theme:function(c){var a=this;if($.inArray("theme",c)===-1){return}var b=Stiam.Storage.getItem("theme")||"b";$(document).find(".ui-btn").removeClass("ui-btn-up-a ui-btn-up-b ui-btn-up-c ui-btn-up-d ui-btn-up-e ui-btn-hover-a ui-btn-hover-b ui-btn-hover-c ui-btn-hover-d ui-btn-hover-e").addClass("ui-btn-up-"+b).attr("data-theme",b);$(document).find(".ui-header, .ui-footer").removeClass("ui-bar-a ui-bar-b ui-bar-c ui-bar-d ui-bar-e").addClass("ui-bar-"+b).attr("data-theme",b);$(document).find(".ui-panel").removeClass("ui-body-a ui-body-b ui-body-c ui-body-d ui-body-e").addClass("ui-body-"+b).attr("data-theme",b)},external:function(a,d){var b=this;var c=d.attr("href");if(window.isphone){a.preventDefault();navigator.app.loadUrl(c,{openExternal:true})}else{d.attr("target","_blank")}}};Stiam.BackToTop={initialize:function(){var a=this;a.button=$("<div>").attr("id","back-top").addClass("back-top").html("sus").hide().appendTo($("body"));a.button.click(function(){$("body,html").animate({scrollTop:0},800)});$(window).unbind(".StiamBackToTop");$(window).bind("scroll.StiamBackToTop",function(){if($(this).scrollTop()>100){a.button.fadeIn("slow")}else{a.button.fadeOut("slow")}})}};Stiam.InfiniteScroll={initialize:function(){var a=this;$(window).unbind(".StiamInfiniteScroll");$(window).bind("scroll.StiamInfiniteScroll",function(){if(Stiam.Storage.getItem("infiniteScroll")!=="on"){return}var c=$('a[data-rel="back"]:visible');if(c.length){return}var e=$('.article-brick:has(".more-articles")');var d=e.position();d=d?d.top:0;if(!d){return}var b=$(window).height()+$(window).scrollTop();if((d-b)>300){return}$("button",e).click()})}};Stiam.Refresh={initialize:function(){var a=this;a.button=$('a[data-icon="refresh"]');a.button.click(function(b){b.preventDefault();Stiam.Storage.settings.query.b_start=0;$(document).trigger(Stiam.Events.query)})}};Stiam.Storage={settings:{showImages:"on",infiniteScroll:"on",theme:"b",fontSize:100,query:{}},initialize:function(b){var a=this;a.db=null;a.localStorage=null;if(window.openDatabase){a.db=openDatabase("stiamro","1.0","stiam.ro",2*1024*1024)}if(window.Storage){a.localStorage=localStorage}return a.reload(b)},getQuery:function(){var a=this;return a.settings.query},setQuery:function(b){var a=this;a.settings.query=b;var c=jQuery.extend({},b);c.b_start=0;c=escape(JSON.stringify(c));a.commit("query",c)},setItem:function(b,c){var a=this;a.settings[b]=c;a.commit(b,c)},getItem:function(b){var a=this;return a.settings[b]},reload:function(e){var a=this;if(!a.db){return a.reloadFromLocalStorage(e)}var b=function(f){return e()};var d=function(f,g){if(g&&g.rows&&g.rows.length){var j=g.rows;for(i=0;i<g.rows.length;i++){var h=j.item(i);if(h.name=="query"){value=JSON.parse(unescape(h.value))}else{value=h.value}a.settings[h.name]=value}}return e()};var c=function(f){f.executeSql("CREATE TABLE IF NOT EXISTS SETTINGS (name unique, value)");f.executeSql("SELECT * FROM SETTINGS",[],d,b)};a.db.transaction(c,b)},commit:function(c,d){var a=this;if(!a.db){return a.commitInLocalStorage(c,d)}var e=function(f){f.executeSql("CREATE TABLE IF NOT EXISTS SETTINGS (name unique, value)");f.executeSql('INSERT OR REPLACE INTO SETTINGS (name, value) VALUES ("'+c+'", "'+d+'")')};var b=function(f){if(window.console){console.log(f)}};a.db.transaction(e,b)},reloadFromLocalStorage:function(b){var a=this;if(!a.localStorage){return b()}$.each(a.settings,function(d,c){var e=a.localStorage.getItem(d);if(d=="query"){e=JSON.parse(unescape(e))}if(e){a.settings[d]=e}});return b()},commitInLocalStorage:function(b,c){var a=this;if(a.localStorage){a.localStorage.setItem(b,c)}}};Stiam.initialize=function(){var c;$(document).unbind(".Stiam");$(document).on("swipeleft.Stiam swiperight.Stiam","#header",function(f){if($.mobile.activePage.jqmData("panel")!=="open"){if(f.type==="swipeleft"){$("#right-panel").panel("open")}else{if(f.type==="swiperight"){$("#left-panel").panel("open")}}}});c=$("#left-panel");var d=new Stiam.Panel(c,{button:$('a[href="#left-panel"]')});c.data("Stiam.Panel",d);c=$("#right-panel");var b=new Stiam.Settings(c,{button:$('a[href="#right-panel"]')});c.data("Stiam.Settings",b);c=$("#body");var a=new Stiam.Listing(c,{});c.data("Stiam.Listing",a);Stiam.InfiniteScroll.initialize();Stiam.BackToTop.initialize();Stiam.Refresh.initialize();$.mobile.page.prototype.options.backBtnTheme="c";window.backs=0;$(document).on("backbutton.Stiam",function(){var e=$('a[data-rel="back"]:visible');if(e.length){return e.click()}if($.mobile.activePage.jqmData("panel")==="open"){$("#right-panel").panel("close");$("#left-panel").panel("close");return}window.backs+=1;$.mobile.showPageLoadingMsg("a","Mai apasă odată pentru a ieşi",true);if(window.backs>1){navigator.app.exitApp()}setTimeout(function(){window.backs=0;$.mobile.hidePageLoadingMsg()},3000)});$(document).on("menubutton.Stiam",function(){$("#right-panel").panel("toggle")});$(document).on("searchbutton.Stiam",function(){$("#left-panel").panel("toggle")});Stiam.Analytics.initialize()};$(document).on("pageinit","#main-page",function(){$('[data-role="page"]').removeAttr("style");window.isphone=false;if(document.URL.indexOf("http://")==-1){window.isphone=true}if(window.isphone){$(document).on("deviceready",function(){navigator.splashscreen.hide();Stiam.Storage.initialize(Stiam.initialize)})}else{Stiam.Storage.initialize(Stiam.initialize)}});